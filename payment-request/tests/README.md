# 支払依頼システム Playwright テスト

このディレクトリには、支払依頼システムのPlaywrightテストが含まれています。

## テスト構成

### テストファイル

- `payment-request.spec.js` - 支払依頼登録ページのテスト
- `approval-list.spec.js` - 承認一覧ページのテスト
- `slip-list.spec.js` - 伝票一覧ページのテスト
- `navigation.spec.js` - ナビゲーション機能のテスト

### セットアップファイル

- `global-setup.js` - グローバルセットアップ（テスト実行前の初期化）
- `global-teardown.js` - グローバルティアダウン（テスト実行後のクリーンアップ）

### ヘルパーファイル

- `fixtures/test-data.js` - テスト用のデータフィクスチャ
- `helpers/page-helpers.js` - ページ操作のヘルパー関数

## テストの実行方法

### 前提条件

1. Node.js 18以上がインストールされていること
2. プロジェクトルートで `npm install` が実行されていること
3. Playwrightブラウザがインストールされていること（`npx playwright install`）

### コマンド

```bash
# 全テストを実行
npm test

# ヘッドレスモードで実行（デフォルト）
npx playwright test

# ブラウザを表示して実行
npm run test:headed

# UIモードで実行
npm run test:ui

# デバッグモードで実行
npm run test:debug

# 特定のテストファイルを実行
npx playwright test payment-request.spec.js

# 特定のブラウザで実行
npx playwright test --project=chromium

# テストレポートを表示
npm run test:report
```

## テスト内容

### 支払依頼登録ページ (`payment-request.spec.js`)

- ページの読み込み確認
- ヘッダー要素の表示確認
- 必須フィールドの表示確認
- 消費税端数処理のラジオボタン動作
- 明細入力ポップアップの動作
- 請求書読取機能の動作
- ファイル選択機能の動作
- フォーム入力の基本動作
- 日付フィールドの動作
- 支払要件の選択動作

### 承認一覧ページ (`approval-list.spec.js`)

- ページの読み込み確認
- 検索条件セクションの表示確認
- 伝票区分・承認状況のラジオボタン動作
- 入力日の日付フィールド動作
- データテーブルの表示確認
- チェックボックスの動作
- 全選択・全解除ボタンの動作
- CSV出力機能の動作
- アクションボタンの表示・動作確認

### 伝票一覧ページ (`slip-list.spec.js`)

- ページの読み込み確認
- 検索条件セクションの表示確認
- 検索フォームの入力動作
- 一覧表示セクションの表示確認
- テーブルの表示・ソート機能確認
- ページネーション機能の動作確認
- 詳細表示モーダルの動作確認

### ナビゲーション機能 (`navigation.spec.js`)

- ページ間のナビゲーション動作
- ヘッダー・フッターの一貫性確認
- レスポンシブデザインの基本動作
- ページ読み込み時間の確認
- JavaScriptエラーの確認
- リソース読み込みの確認

## テストデータ

`fixtures/test-data.js` に以下のテストデータが定義されています：

- 担当者データ（有効・無効）
- 相手先データ（有効・無効）
- 伝票データ（有効・無効）
- 明細データ（番組・プロジェクト・その他）
- 検索条件データ
- ファイルデータ
- 日付データ
- 金額データ
- 文字列データ

## ヘルパー関数

`helpers/page-helpers.js` に以下のヘルパー関数が定義されています：

- フォーム操作（入力・選択・チェック）
- ポップアップ操作
- テーブル操作
- 日付・金額入力
- ページ読み込み待機
- スクリーンショット撮影
- その他の共通操作

## 設定ファイル

- `playwright.config.js` - Playwrightの設定
- `package.json` - プロジェクトの依存関係とスクリプト

## 注意事項

1. テスト実行前にローカルサーバーが起動していることを確認してください
2. テストは `http://localhost:3000` で実行されることを前提としています
3. テスト実行中は他の操作を行わないでください
4. テスト結果は `test-results/` ディレクトリに保存されます

## トラブルシューティング

### よくある問題

1. **ブラウザが起動しない**
   - `npx playwright install` を実行してください

2. **テストがタイムアウトする**
   - ローカルサーバーが起動しているか確認してください
   - ネットワーク接続を確認してください

3. **要素が見つからない**
   - ページの読み込みが完了しているか確認してください
   - セレクターが正しいか確認してください

4. **ファイルアップロードが失敗する**
   - テスト用のファイルが存在するか確認してください
   - ファイルパスが正しいか確認してください

### デバッグ方法

1. デバッグモードで実行：`npm run test:debug`
2. UIモードで実行：`npm run test:ui`
3. スクリーンショットを確認：`test-results/screenshots/`
4. トレースファイルを確認：`test-results/`

