<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0">
    <title>支払依頼登録(github連携14)</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/data-manager.js"></script>
</head>
<body>
    <header>
        <div class="header-left">
            <h1>EXAS</h1>
            <nav>
                <ul>
                    <li><a href="#" id="menu-btn">メニュー</a></li>
                    <li><a href="#">過去伝票照会</a></li>
                    <li><a href="#">概算精算</a></li>
                    <li><a href="#" id="slip-list-link">入力伝票照会</a></li>
                    <li><a href="#">ヘルプ</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-info">
                <span>ログインユーザ： テストユーザ①</span>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="form-row title-row">
                <h1>支払依頼登録</h1>
                <button type="button" id="invoice-scan-btn" class="secondary-btn">請求書読取</button>
            </div>
            <hr class="section-divider">

            <form id="payment-request-form">
                <div class="form-row staff-row">
                    <div class="form-group half-width">
                        <div class="search-with-result">
                            <button type="button" class="info-btn">担当者 <span class="required-star">*</span></button>
                            <div class="search-input">
                                <input type="text" id="staff-id" name="staff-id">
                            </div>
                            <div class="search-result-inline">
                                <span id="staff-name" class="inline-result-value"></span>
                                <span id="staff-department" class="inline-result-value"></span>
                            </div>
                            <div class="search-result" style="display: none;">
                                <div class="result-item">
                                    <span class="result-label">担当者:</span>
                                    <span class="result-value staff-name-value"></span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">部署名:</span>
                                    <span class="result-value staff-department-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group rounding-group">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label>消費税端数処理:</label>
                            <div class="rounding-options">
                                <input type="radio" id="round-half-up" name="tax-rounding" value="half-up" checked>
                                <label for="round-half-up">四捨五入</label>
                                <input type="radio" id="round-up" name="tax-rounding" value="up">
                                <label for="round-up">切り上げ</label>
                                <input type="radio" id="round-down" name="tax-rounding" value="down">
                                <label for="round-down">切り捨て</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group hidden-input">
                        <input type="hidden" id="registration-number" name="registration-number" readonly>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group half-width">
                        <div class="search-with-result">
                            <button type="button" class="info-btn">相手先 <span class="required-star">*</span></button>
                            <div class="search-input">
                                <input type="text" id="payee-id" name="payee-id">
                            </div>
                            <div class="search-result-inline">
                                <span id="payee-name" class="inline-result-value"></span>
                                <span id="payee-registration" class="inline-result-value"></span>
                                <button type="button" class="address-info-btn">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="9" cy="9" r="7" stroke="#888" stroke-width="2" fill="none"/>
                                        <line x1="14" y1="14" x2="19" y2="19" stroke="#888" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <div class="address-popup">
                                        <div class="address-popup-content"></div>
                                    </div>
                                </button>
                            </div>
                            <div class="search-result" style="display: none;">
                                <div class="result-item">
                                    <span class="result-label">相手先:</span>
                                    <span class="result-value payee-name-value"></span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">登録番号:</span>
                                    <span class="result-value payee-registration-value"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group payment-account-group">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <label for="payment-account">支払先口座:</label>
                            <div class="payment-account-result-inline">
                                <span id="payment-account-text" class="inline-result-value" style="display:none;">通常支払口座</span>
                                <button type="button" class="address-info-btn" id="payment-account-info-btn">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="9" cy="9" r="7" stroke="#888" stroke-width="2" fill="none"/>
                                        <line x1="14" y1="14" x2="19" y2="19" stroke="#888" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <div class="address-popup">
                                        <div class="address-popup-content"></div>
                                    </div>
                                </button>
                            </div>
                            <input type="hidden" id="payment-account" name="payment-account" readonly tabindex="-1">
                        </div>
                    </div>
                </div>

                <hr class="section-divider">

                <div class="form-row simple-row">
                  <div class="form-group occurrence-and-transaction-group">
                    <label for="occurrence-start-month-picker" class="required-label common-label">発生月:</label>
                    <input type="month" id="occurrence-start-month-picker" name="occurrence-start-month">
                    <span class="month-separator">～</span>
                    <input type="month" id="occurrence-end-month-picker" name="occurrence-end-month">
                    <label for="transaction-date" class="transaction-date-label">取引年月日:</label>
                    <input type="date" id="transaction-date" name="transaction-date">
                  </div>
                </div>
                <div class="form-row">
                    <div class="form-group invoice-group">
                        <label for="invoice-number" class="required-label common-label">請求書No:</label>
                        <input type="text" id="invoice-number" name="invoice-number">
                    </div>
                    <div class="form-group remarks-group">
                        <label for="remarks">備考（業務決裁No.等）:</label>
                        <input type="text" id="remarks" name="remarks">
                    </div>
                </div>
                <div class="form-row slip-title-row">
                    <label for="slip-title" class="common-label" style="font-weight: bold;">伝票タイトル:</label>
                    <input type="text" id="slip-title" name="slip-title" style="flex:1; min-width:0;">
                    <input type="text" id="slip-title-extra" name="slip-title-extra" style="flex:1; min-width:0;">
                </div>
                <hr class="section-divider">
                <div class="form-row details-section">
                    <div class="table-container">
                        <table id="details-table">
                            <thead>
                                <tr>
                                    <th class="sortable draggable resizable" data-col="no">No<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="main">番組/プロジェクト<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="department">計上部署<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="sub">放送日/プロジェクト内訳<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="account">科目<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="summary">入力摘要<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="amount">金額<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="taxCategory">消費税区分<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="taxType">外税内税区分<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="taxAmount">消費税額<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="advance">立替先<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="extraBudget">予算外<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="segment">セグメント<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="counterSegment">相手セグメント<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="postingNo">計上No<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="entertainment">交際費<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="subcontract">下請法<span class="column-resizer"></span></th>
                                    <th class="sortable draggable resizable" data-col="content">コンテンツ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 明細データがここに入ります -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-row details-button-row">
                    <div class="button-group">
                        <button type="button" id="add-detail-btn">明細入力</button>
                        <button type="button" id="edit-detail-btn">明細挿入</button>
                        <button type="button" id="delete-detail-btn">明細削除</button>
                        <span id="selection-info" class="selection-info" style="display: none;"></span>
                    </div>
                    <div class="details-amount-group">
                        <span class="amount-label">内消費税額：</span><span id="internal-tax-value" class="amount-value">￥0</span>
                        <span class="amount-label">支払金額：</span><span id="payment-amount-value" class="amount-value">￥0</span>
                    </div>
                </div>
                <div class="details-separator"></div>
                <div class="payment-info-row">
                    <div class="form-group" style="flex: 1 1 0;">
                        <label for="payment-requirements">支払要件</label>
                        <select id="payment-requirements" name="payment-requirements">
                            <option value="">選択してください</option>
                            <option value="当店券振込" selected>当店券振込</option>
                            <option value="現金支払">現金支払</option>
                            <option value="小切手支払">小切手支払</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1 1 0;">
                        <label for="payment-date">支払日</label>
                        <input type="date" id="payment-date" name="payment-date">
                    </div>
                    <div class="form-group" style="flex: 1 1 0;">
                        <label for="payment-hope-date">支払希望日</label>
                        <input type="date" id="payment-hope-date" name="payment-hope-date">
                    </div>
                    <div class="form-group" style="flex: 2 1 0;">
                        <label for="comment">申送りコメント</label>
                        <textarea id="comment" name="comment" rows="1" title=""></textarea>
                    </div>
                </div>
                
                <!-- 添付資料セクション -->
                <hr class="section-divider">
                <div class="attachment-section">
                    <div class="attachment-header">
                        <h3>証憑添付</h3>
                        <input type="file" id="file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx" style="display: none;">
                        <button type="button" id="select-file-btn" class="secondary-btn">ファイルを選択</button>
                    </div>
                    <div class="attachment-drop-zone" id="attachment-drop-zone">
                        <div class="drop-zone-content">
                            <p>ファイルをここにドラッグ＆ドロップ</p>
                        </div>
                        <div class="attachment-list" id="attachment-list">
                            <!-- 添付されたファイルがここに表示されます -->
                        </div>
                    </div>
                    <div class="attachment-actions">
                        <button type="button" id="detach-btn" class="secondary-btn" disabled>解除</button>
                        <button type="button" id="preview-btn" class="secondary-btn" disabled>参照</button>
                    </div>
                </div>
                
                <hr class="section-divider">
                <div class="tax-summary-section">
                    <table id="tax-summary-table" class="tax-summary-table">
                        <thead>
                            <tr>
                                <th class="row-label-header"></th>
                                <th id="tax-category-10" class="tax-column" style="display: none;">支払課仕10%</th>
                                <th id="tax-category-8" class="tax-column" style="display: none;">支払課仕8%</th>
                                <th id="tax-category-8-reduced" class="tax-column" style="display: none;">支払課仕8%軽減</th>
                                <th id="tax-category-5" class="tax-column" style="display: none;">支払課仕5%</th>
                                <th id="tax-category-exempt" class="tax-column" style="display: none;">支払非課仕</th>
                                <th id="tax-category-excluded" class="tax-column" style="display: none;">支払対象外</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="row-label">税抜額</td>
                                <td id="tax-excluded-10" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-excluded-8" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-excluded-8-reduced" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-excluded-5" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-excluded-exempt" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-excluded-excluded" class="amount-cell tax-column" style="display: none;">0</td>
                            </tr>
                            <tr>
                                <td class="row-label">消費税額</td>
                                <td id="tax-amount-10" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-amount-8" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-amount-8-reduced" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-amount-5" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-amount-exempt" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-amount-excluded" class="amount-cell tax-column" style="display: none;">0</td>
                            </tr>
                            <tr>
                                <td class="row-label">税込額</td>
                                <td id="tax-included-10" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-included-8" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-included-8-reduced" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-included-5" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-included-exempt" class="amount-cell tax-column" style="display: none;">0</td>
                                <td id="tax-included-excluded" class="amount-cell tax-column" style="display: none;">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-row button-row">
                    <button type="button" id="register-btn">伝票登録</button>
                    <button type="reset" id="clear-btn">クリア</button>
                    <span id="registration-number-display" class="reg-number-display"></span>
                </div>
            </form>
        </div>
    </main>

    <footer>
        <p>Copyright © IT-Studio All Rights Reserved.</p>
    </footer>

    <!-- 明細入力ポップアップ -->
    <div id="detail-popup" class="popup">
        <div class="popup-content detail-modal draggable-popup" style="transform: translate(-50%, -50%)">
            <div class="popup-header drag-handle">
                <h2 id="detail-popup-title">明細修正</h2>
                <span class="close">×</span>
            </div>
            <form id="detail-form">
                <div class="form-row radio-row tax-rounding-like align-radio">
                    <label class="required-label">処理区分</label>
                    <div class="rounding-options">
                        <input type="radio" id="detail-type-program" name="detail-type" value="program" checked>
                        <label for="detail-type-program">番組</label>
                        <input type="radio" id="detail-type-project" name="detail-type" value="project">
                        <label for="detail-type-project">プロジェクト</label>
                        <input type="radio" id="detail-type-other" name="detail-type" value="other">
                        <label for="detail-type-other">経費その他</label>
                    </div>
                </div>
                <div id="detail-program-group" class="detail-group" style="display: flex; flex-direction: column;">
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">番組 <span class="required-star">*</span></button>
                        <input type="text" id="detail-program" name="detail-program">
                        <button type="button" class="info-btn">放送日 <span class="required-star">*</span></button>
                        <input type="date" id="detail-broadcast-date" name="detail-broadcast-date">
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">科目 <span class="required-star">*</span></button>
                        <input type="text" id="detail-account" name="detail-account">
                        <button type="button" class="meeting-btn">打合せ</button>
                        <div class="checkbox-pair"><input type="checkbox" id="detail-subcontract" name="detail-subcontract"><label for="detail-subcontract">下請法</label></div>
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">セグメント</label>
                        <select id="detail-segment" name="detail-segment"><option>テレビ放送事業</option></select>
                    </div>
                    <div class="form-row detail-row">
                        <label>入力摘要</label>
                        <input type="text" id="detail-summary" name="detail-summary">
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">金額</label>
                        <input type="text" id="detail-amount" name="detail-amount">
                    </div>
                    <div class="form-row detail-row tax-amount-row">
                        <label>消費税額</label>
                        <input type="text" id="detail-tax-amount" name="detail-tax-amount" readonly>
                        <label class="tax-category-label required-label">消費税区分</label>
                        <select id="detail-tax-category" name="detail-tax-category" class="tax-category-select">
                            <option value="課仕8%">課仕8%</option>
                            <option value="課仕8%（軽減）">課仕8%（軽減）</option>
                            <option value="課仕10%" selected>課仕10%</option>
                            <option value="非課仕">非課仕</option>
                            <option value="対象外">対象外</option>
                            <option value="課仕5%">課仕5%</option>
                            <option value="免税8%">免税8%</option>
                            <option value="免税8%（軽減）">免税8%（軽減）</option>
                            <option value="免税10%">免税10%</option>
                            <option value="免税5%">免税5%</option>
                        </select>
                        <select id="detail-tax-type" name="detail-tax-type" class="tax-type-select">
                            <option value="外税" selected>外税</option>
                            <option value="内税">内税</option>
                            <option value="対象外">対象外</option>
                        </select>
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">立替先</button>
                        <input type="text" id="detail-advance" name="detail-advance">
                    </div>
                </div>
                <div id="detail-project-group" class="detail-group" style="display: none; flex-direction: column;">
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">プロジェクト <span class="required-star">*</span></button>
                        <input type="text" id="detail-project" name="detail-project">
                        <button type="button" class="info-btn">プロジェクト内訳 <span class="required-star">*</span></button>
                        <input type="text" id="detail-project-detail" name="detail-project-detail">
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">科目 <span class="required-star">*</span></button>
                        <input type="text" id="detail-account-project" name="detail-account-project">
                        <button type="button" class="meeting-btn">打合せ</button>
                        <div class="checkbox-pair"><input type="checkbox" id="detail-subcontract-project" name="detail-subcontract-project"><label for="detail-subcontract-project">下請法</label></div>
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">セグメント</label>
                        <select id="detail-segment-project" name="detail-segment-project"><option>テレビ放送事業</option></select>
                    </div>
                    <div class="form-row detail-row">
                        <label>入力摘要</label>
                        <input type="text" id="detail-summary-project" name="detail-summary-project">
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">金額</label>
                        <input type="text" id="detail-amount-project" name="detail-amount-project">
                    </div>
                    <div class="form-row detail-row tax-amount-row">
                        <label>消費税額</label>
                        <input type="text" id="detail-tax-amount-project" name="detail-tax-amount-project" readonly>
                        <label class="tax-category-label required-label">消費税区分</label>
                        <select id="detail-tax-category-project" name="detail-tax-category-project" class="tax-category-select">
                            <option value="課仕8%">課仕8%</option>
                            <option value="課仕8%（軽減）">課仕8%（軽減）</option>
                            <option value="課仕10%" selected>課仕10%</option>
                            <option value="非課仕">非課仕</option>
                            <option value="対象外">対象外</option>
                            <option value="課仕5%">課仕5%</option>
                            <option value="免税8%">免税8%</option>
                            <option value="免税8%（軽減）">免税8%（軽減）</option>
                            <option value="免税10%">免税10%</option>
                            <option value="免税5%">免税5%</option>
                        </select>
                        <select id="detail-tax-type-project" name="detail-tax-type-project" class="tax-type-select">
                            <option value="外税" selected>外税</option>
                            <option value="内税">内税</option>
                            <option value="対象外">対象外</option>
                        </select>
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">立替先</button>
                        <input type="text" id="detail-advance-project" name="detail-advance-project">
                    </div>
                </div>
                <div id="detail-other-group" class="detail-group" style="display: none; flex-direction: column;">
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">部署 <span class="required-star">*</span></button>
                        <input type="text" id="detail-department" name="detail-department">
                        <button type="button" class="info-btn">目的</button>
                        <input type="text" id="detail-purpose" name="detail-purpose">
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">科目 <span class="required-star">*</span></button>
                        <input type="text" id="detail-account-other" name="detail-account-other">
                        <button type="button" class="meeting-btn">打合せ</button>
                        <div class="checkbox-pair"><input type="checkbox" id="detail-subcontract-other" name="detail-subcontract-other"><label for="detail-subcontract-other">下請法</label></div>
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">セグメント</label>
                        <select id="detail-segment-other" name="detail-segment-other"><option>テレビ放送事業</option></select>
                    </div>
                    <div class="form-row detail-row">
                        <label>入力摘要</label>
                        <input type="text" id="detail-summary-other" name="detail-summary-other">
                    </div>
                    <div class="form-row detail-row">
                        <label class="required-label">金額</label>
                        <input type="text" id="detail-amount-other" name="detail-amount-other">
                    </div>
                    <div class="form-row detail-row tax-amount-row">
                        <label>消費税額</label>
                        <input type="text" id="detail-tax-amount-other" name="detail-tax-amount-other" readonly>
                        <label class="tax-category-label required-label">消費税区分</label>
                        <select id="detail-tax-category-other" name="detail-tax-category-other" class="tax-category-select">
                            <option value="課仕8%">課仕8%</option>
                            <option value="課仕8%（軽減）">課仕8%（軽減）</option>
                            <option value="課仕10%" selected>課仕10%</option>
                            <option value="非課仕">非課仕</option>
                            <option value="対象外">対象外</option>
                            <option value="課仕5%">課仕5%</option>
                            <option value="免税8%">免税8%</option>
                            <option value="免税8%（軽減）">免税8%（軽減）</option>
                            <option value="免税10%">免税10%</option>
                            <option value="免税5%">免税5%</option>
                        </select>
                        <select id="detail-tax-type-other" name="detail-tax-type-other" class="tax-type-select">
                            <option value="外税" selected>外税</option>
                            <option value="内税">内税</option>
                            <option value="対象外">対象外</option>
                        </select>
                    </div>
                    <div class="form-row detail-row">
                        <button type="button" class="info-btn">立替先</button>
                        <input type="text" id="detail-advance-other" name="detail-advance-other">
                    </div>
                </div>
                <div class="form-row button-row">
                    <button type="submit" id="detail-submit-btn">登録</button>
                    <button type="button" id="detail-clear">クリア</button>
                    <button type="button" id="detail-cancel">キャンセル</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 請求書読取ポップアップ -->
    <div id="invoice-scan-popup" class="popup">
        <div class="popup-content">
            <span class="close">&times;</span>
            <h2>請求書読取</h2>
            <form id="invoice-scan-form">
                <div class="form-row">
                    <div class="form-group full-width">
                        <label for="invoice-scan-file">請求書ファイルを選択してください:</label>
                        <input type="file" id="invoice-scan-file" name="invoice-scan-file" accept=".pdf,.jpg,.jpeg,.png">
                        <div id="selected-file-name" class="selected-file-name" style="display: none;">
                            <span>選択されたファイル: </span>
                            <span id="file-name-display"></span>
                        </div>
                    </div>
                </div>
                <div class="form-row button-row">
                    <button type="submit">読み取り開始</button>
                    <button type="button" id="invoice-scan-cancel">キャンセル</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ローディングポップアップ -->
    <div id="loading-popup" class="popup" style="display: none;">
        <div class="popup-content loading-modal">
            <div class="loading-spinner"></div>
            <p>請求書を読み取っています...</p>
        </div>
    </div>

    <!-- 結果表示ポップアップ -->
    <div id="result-popup" class="popup" style="display: none;">
        <div class="popup-content result-modal">
            <span class="close">&times;</span>
            <h2 id="result-title">処理結果</h2>
            <div id="result-content" class="result-content">
                <!-- 結果内容がここに表示されます -->
            </div>
            <div class="form-row button-row">
                <button type="button" id="result-close-btn">閉じる</button>
            </div>
        </div>
    </div>

    <!-- 帳票モーダル -->
    <div id="slip-popup" class="popup" style="display:none;">
        <div class="slip-modal">
            <span class="slip-close" style="position:absolute;top:12px;right:24px;font-size:2rem;cursor:pointer;">&times;</span>
            <div class="slip-header">
                <div style="display:flex;align-items:center;gap:16px;">
                    <span id="slip-header-type" style="font-size:1.0rem;font-weight:bold;">(経費その他)</span>
                    <span style="font-size:1.0rem;">支払依頼書</span>
                </div>
                <div class="slip-logo">支</div>
                <div style="position:absolute;top:40px;right:24px;text-align:right;">
                    <div style="font-size:0.9rem;">2025/05/29 1/1頁</div>
                </div>
            </div>
            <div class="slip-info-area">
                <div class="slip-info-row">
                    <div class="slip-info-box"><span>入力日</span><span id="slip-input-date"></span></div>
                    <div class="slip-info-box"><span>担当者</span><span id="slip-staff-name"></span></div>
                    <div class="slip-info-box"><span>入力者</span><span id="slip-inputter"></span></div>
                </div>
                <div class="slip-info-row">
                    <div class="slip-info-box"><span>相手先</span><span id="slip-payee-name"></span></div>
                </div>
                <div class="slip-info-row">
                    <div class="slip-info-box" style="width:100%;"><span>タイトル</span><span id="slip-title-display"></span></div>
                </div>
                <div class="slip-info-row" style="justify-content:flex-end;">
                    <div class="slip-amount-box">
                        <span>支払金額</span>
                        <span id="slip-payment-amount" style="font-size:1.3rem;font-weight:bold;margin-left:16px;"></span>
                    </div>
                </div>
                <div style="text-align:right;margin-top:8px;">
                    <span style="font-size:0.9rem;">内消費税額 <span id="slip-internal-tax"></span></span>
                </div>
                <div class="slip-info-row">
                    <div class="slip-info-box"><span>計上予定月</span><span id="slip-planned-month"></span></div>
                    <div class="slip-info-box"><span>発生月</span><span id="slip-occurrence-month"></span></div>
                    <div class="slip-info-box"><span>支払予定日</span><span id="slip-payment-date"></span></div>
                </div>
                <div class="slip-info-row">
                    <div class="slip-info-box"><span>請求書No</span><span id="slip-invoice-number"></span></div>
                    <div class="slip-info-box"><span>備考（業務決裁No.等）</span><span id="slip-remarks"></span></div>
                    <div class="slip-info-box" style="min-width:300px;"><span>振込先</span><span id="slip-payment-account"></span></div>
                </div>
            </div>
            <div class="slip-details-area">
                <table class="slip-table" id="slip-details-table">
                    <thead>
                        <tr>
                            <th>行No</th><th>番組/プロジェクト</th><th>計上部署</th><th>放送日/プロジェクト内訳</th><th>科目</th><th>入力摘要</th><th>金額</th><th>消費税区分</th><th>外税/内税</th><th>消費税額</th><th>立替先</th><th>予算外</th><th>セグメント</th><th>相手セグメント</th><th>計上No</th><th>交際費</th><th>下請法</th><th>コンテンツ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- JSで明細行を生成 -->
                    </tbody>
                </table>
            </div>
            <div class="slip-footer">
                <div>
                    <div>税抜額: <span id="slip-payment-amount-footer"></span></div>
                    <div>消費税額: <span id="slip-tax-included-amount"></span></div>
                    <div>税込額: <span id="slip-internal-tax-footer"></span></div>
                </div>
                <div>
                    <div>振込先銀行: <span id="slip-payment-account-footer"></span></div>
                    <div>営業部 普通 0001 ◯◯◯◯</div>
                </div>
                <div style="font-size:10px;">
                    支払依頼者（署名）<br>登録番号：<span id="slip-registration-number-footer"></span><br>〒000-0000
                </div>
            </div>
        </div>
    </div>

    <div style="position: fixed; right: 24px; bottom: 18px; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end;">
        <button type="button" id="show-slip-btn-bottom" class="secondary-btn" onclick="showSlipPopup()" style="font-size: 0.85rem; padding: 4px 12px; min-width: 90px; pointer-events: auto; cursor: pointer;">伝票イメージ</button>
    </div>

    <script src="js/script.js"></script>
    <script src="js/invoice-scan.js"></script>
</body>
</html> 